{% extends "events/base.html" %}

{% load static %}
{% load humanize %}
{% load crispy_forms_tags %}

{% block page_heading %}
    <h1>{{ event.name }}</h1>
{% endblock page_heading %}

{% block content %}
    <div>

        <!-- Event Application Status Counts -->
        <div class="panel-group">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h4 class="panel-title">
                  <a data-toggle="collapse" href="#event-application-status-counts">Event Application Status Counts</a>
                </h4>
              </div>
              <div id="event-application-status-counts" class="panel-collapse collapse">
                <div class="panel-body">
                    <div>
                        <b>Approved:</b> {{event.application_status_counts.approved}}
                    </div>
                    <div>
                        <b>Pending:</b> {{event.application_status_counts.pending}}
                    </div>
                    <div>
                        <b>Rejected:</b> {{event.application_status_counts.rejected}}
                    </div>
                    <div>
                        <b>Withdrawn:</b> {{event.application_status_counts.withdrawn}}
                    </div>
                </div>
              </div>
            </div>
        </div>

        <!-- Reasons for Withdrawing -->
        <div class="panel-group">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h4 class="panel-title">
                  <a data-toggle="collapse" href="#reason-for-withdrawing-counts">Reasons for Withdrawing</a>
                </h4>
              </div>
              <div id="reason-for-withdrawing-counts" class="panel-collapse collapse">
                <div class="panel-body">
                    <div>
                        <b>Prefer not to say:</b> {{event.reasons_for_withdrawing_counts.prefer_not_to_say}}
                    </div>
                    <div>
                        <b>Illness:</b> {{event.reasons_for_withdrawing_counts.illness}}
                    </div>
                    <div>
                        <b>No longer interested:</b> {{event.reasons_for_withdrawing_counts.not_interested}}
                    </div>
                    <div>
                        <b>Change of plans:</b> {{event.reasons_for_withdrawing_counts.change_of_plans}}
                    </div>
                    <div>
                        <b>Too expensive:</b> {{event.reasons_for_withdrawing_counts.too_expensive}}
                    </div>
                    <div>
                        <b>Inconvenient location:</b> {{event.reasons_for_withdrawing_counts.inconvenient_location}}
                    </div>
                    <div>
                        
                        <!-- Other Reasons for Withdrawing -->
                        <div class="panel-group">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <div class="panel-title">
                                        <a data-toggle="collapse" href="#other-reason-for-withdrawing-counts">
                                            <b>Other:</b> {{event.reasons_for_withdrawing_counts.other}}
                                        </a>
                                    </vid>
                                </div>
                                <div id="other-reason-for-withdrawing-counts" class="panel-collapse collapse">
                                    <div class="panel-body">
                                        <ul>
                                            {% for reason in event.other_reasons_for_withdrawing %}
                                                <div>
                                                    <li>{{reason}}</li>
                                                </div>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- Event Applications -->
        <div class="panel-group">
            <div class="panel panel-default">
                <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" href="#event-applications">Event Applications</a>
                </h4>
                </div>
                <div id="event-applications" class="panel-collapse collapse">
                <div class="panel-body">
                    {% if formset_applications %}
                        {{ formset.management_data }}

                        <div class="alert alert-danger alert-dismissible col-12 mx-1" role="alert">
                            <div id="form_errors">
                                {{formset.form_errors}}
                                {% if formset.non_field_errors %}
                                    {{ formset.non_field_errors }}
                                {% endif %}
                                {% if formset.non_form_errors %}
                                    {{ formset.non_form_errors }}
                                {% endif %}
                                {% for form in formset.forms %}
                                    {% if form.errors %}
                                        Form number {{ forloop.counter }}:
                                        <ul class="errorlist">
                                        {% for key, error in form.errors.items %}
                                            <li>{{form.fields}}
                                                <ul class="errorlist">
                                                    <li>{{error}}</li>
                                                </ul>
                                            </li>
                                        {% endfor %}
                                        </ul>
                                    {% endif %}
                                {% endfor %}
                    
                            </div>
                        </div>

                        {% csrf_token %}
                        {% for form in formset_applications %}
                            <div class="panel-group">
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <div class="panel-title">
                                            <a data-toggle="collapse" href="#event-application-form-{{form.id.auto_id}}">
                                                <b>Name here</b>
                                            </a>
                                        </vid>
                                    </div>
                                    <div id="event-application-form-{{form.id.auto_id}}" class="panel-collapse collapse">
                                        <div class="panel-body">
                                            <form method="post">
                                                {{ formset_applications.managment_form }}
                                                {% csrf_token %}

                                                {{ form.non_field_errors }}
                                                {% for field in form.fields %}
                                                    <div>{{ field }}</div>
                                                    {% if field.errors %}
                                                            <div class="alert alert-danger">
                                                                {{ field.errors }}
                                                            </div>
                                                    {% endif %}
                                                {% endfor %}


                                                {% crispy form %}
                                                {% for hidden in form.hidden_fields %}
                                                    {{ hidden }}
                                                {% endfor %}
                                            <button type="submit" class="btn btn-primary">
                                            </button>
                                            <br>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p>No event applications</p>
                    {% endif %}
                </div>
            </div>
        </div>

    </div>

{% endblock content %}